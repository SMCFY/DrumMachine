<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="30,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">classdef</span> impactSynth &lt; audioPlugin</span></span>
<span class="srcline"><span class="lineno"><a href="30,2" id="srcline2">  2</a></span><span class="line">    <span class="comment">% audio plugin for producing bubble sounds</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,3" id="srcline3">  3</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,4" id="srcline4">  4</a></span><span class="line">    <span class="keyword">properties</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,5" id="srcline5">  5</a></span><span class="line">        <span class="comment">% interfaced parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,6" id="srcline6">  6</a></span><span class="line">        strikePos = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,7" id="srcline7">  7</a></span><span class="line">        strikeVig = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,8" id="srcline8">  8</a></span><span class="line">        dimension = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,9" id="srcline9">  9</a></span><span class="line">        material = 1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,11" id="srcline11"> 11</a></span><span class="line">        instID = 1; <span class="comment">% instrument ID</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,12" id="srcline12"> 12</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,13" id="srcline13"> 13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,14" id="srcline14"> 14</a></span><span class="line">    <span class="keyword">properties</span> (Dependent)</span></span>
<span class="srcline"><span class="lineno"><a href="30,15" id="srcline15"> 15</a></span><span class="line">        trig = <span class="string">'noteOff'</span>; <span class="comment">% noteState</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,16" id="srcline16"> 16</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,17" id="srcline17"> 17</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,18" id="srcline18"> 18</a></span><span class="line">    <span class="keyword">properties</span> (Access = private)</span></span>
<span class="srcline"><span class="lineno"><a href="30,19" id="srcline19"> 19</a></span><span class="line">        <span class="comment">% vst parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,20" id="srcline20"> 20</a></span><span class="line">        fs; <span class="comment">% sampling rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,21" id="srcline21"> 21</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,22" id="srcline22"> 22</a></span><span class="line">        buff; <span class="comment">% buffer for generated waveform</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,23" id="srcline23"> 23</a></span><span class="line">        t = 2; <span class="comment">% buffer length in seconds</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,24" id="srcline24"> 24</a></span><span class="line">        readIndex = [1; 1; 1; 1]; <span class="comment">% reading position in buffers</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,25" id="srcline25"> 25</a></span><span class="line">        soundOut = [0; 0; 0; 0]; <span class="comment">% state variable decides whether to output the signal from the buffer or not</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,27" id="srcline27"> 27</a></span><span class="line">        frameBuff; <span class="comment">% buffer for output frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,28" id="srcline28"> 28</a></span><span class="line">        maxFrameSize; <span class="comment">% maximum frame size in samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,30" id="srcline30"> 30</a></span><span class="line">        noteState = <span class="string">'noteOff'</span>; <span class="comment">% trig</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,32" id="srcline32"> 32</a></span><span class="line">        <span class="comment">%=================================== synth parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,33" id="srcline33"> 33</a></span><span class="line">        modes = [112, 203, 259, 279, 300, 332, 345, 375, 398, 407, 450, 473, 488, 488, 547, 596,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,34" id="srcline34"> 34</a></span><span class="line">                 625, 653, 679, 692, 705, 760, 773, 806, 852, 899, 924, 975, 998, 1019, 1046, 1109,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,35" id="srcline35"> 35</a></span><span class="line">                 1134, 1164, 1192, 1226, 1309, 1358, 1379, 1411, 1461, 1532, 1610, 1683, 1758, 1880,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,36" id="srcline36"> 36</a></span><span class="line">                 2027, 2131, 2271, 2515, 2731, 2809, 2922, 3224, 4694];</span></span>
<span class="srcline"><span class="lineno"><a href="30,37" id="srcline37"> 37</a></span><span class="line">        decay = [0.9999 0.9999 0.9998 0.9998 0.9998 0.9997 0.9997 0.9996 0.9996 0.9995<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,38" id="srcline38"> 38</a></span><span class="line">                 0.9995 0.9994 0.9994 0.9993 0.9993 0.9992 0.9992 0.9991 0.9991 0.999 0.999<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,39" id="srcline39"> 39</a></span><span class="line">                 0.998 0.998 0.997 0.997 0.996 0.996 0.995 0.995 0.994 0.994 0.993<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,40" id="srcline40"> 40</a></span><span class="line">                 0.993 0.992 0.992 0.991 0.991 0.991 0.991 0.991 0.991 0.991 0.991 0.991 0.99<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,41" id="srcline41"> 41</a></span><span class="line">                 0.993 0.992 0.991 0.99 0.98 0.98 0.98 0.97 0.97 0.97];</span></span>
<span class="srcline"><span class="lineno"><a href="30,42" id="srcline42"> 42</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,43" id="srcline43"> 43</a></span><span class="line">        lpfPole = 0.5; <span class="comment">% lowpass filter pole radius - loss filter damping</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,44" id="srcline44"> 44</a></span><span class="line">        excGain = 0.5; <span class="comment">% gain coefficient for the excitation</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,45" id="srcline45"> 45</a></span><span class="line">        strikeGain; <span class="comment">% gain coefficient for each mode</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,46" id="srcline46"> 46</a></span><span class="line">        m = 0; <span class="comment">% slope of transfer fuction</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,47" id="srcline47"> 47</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,48" id="srcline48"> 48</a></span><span class="line">        resBank = [audioread(<span class="string">'Analyses/tom_res.wav'</span>)'; <span class="comment">% extracted residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,49" id="srcline49"> 49</a></span><span class="line">                   audioread(<span class="string">'Analyses/snare_res.wav'</span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="30,50" id="srcline50"> 50</a></span><span class="line">                   audioread(<span class="string">'Analyses/cymbal_res.wav'</span>)';</span></span>
<span class="srcline"><span class="lineno"><a href="30,51" id="srcline51"> 51</a></span><span class="line">                   audioread(<span class="string">'Analyses/kick_res.wav'</span>)'];</span></span>
<span class="srcline"><span class="lineno"><a href="30,52" id="srcline52"> 52</a></span><span class="line">        resPadded; <span class="comment">% zero padded residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,53" id="srcline53"> 53</a></span><span class="line">        <span class="comment">%===================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,54" id="srcline54"> 54</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,55" id="srcline55"> 55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,56" id="srcline56"> 56</a></span><span class="line">    <span class="keyword">properties</span> (Constant)</span></span>
<span class="srcline"><span class="lineno"><a href="30,57" id="srcline57"> 57</a></span><span class="line">       PluginInterface = audioPluginInterface(<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,58" id="srcline58"> 58</a></span><span class="line">           audioPluginParameter(<span class="string">'strikePos'</span>,<span class="string">'DisplayName'</span>,<span class="string">'StrikePosition'</span>,<span class="string">'Mapping'</span>,{<span class="string">'lin'</span>,0,1}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,59" id="srcline59"> 59</a></span><span class="line">           audioPluginParameter(<span class="string">'strikeVig'</span>,<span class="string">'DisplayName'</span>,<span class="string">'StrikeVigor'</span>,<span class="string">'Mapping'</span>,{<span class="string">'lin'</span>,0,1}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,60" id="srcline60"> 60</a></span><span class="line">           audioPluginParameter(<span class="string">'dimension'</span>,<span class="string">'DisplayName'</span>,<span class="string">'Dimension'</span>,<span class="string">'Mapping'</span>,{<span class="string">'lin'</span>,0.5,1.5}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,61" id="srcline61"> 61</a></span><span class="line">           audioPluginParameter(<span class="string">'material'</span>,<span class="string">'DisplayName'</span>,<span class="string">'Material'</span>,<span class="string">'Mapping'</span>,{<span class="string">'lin'</span>,0,1}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,62" id="srcline62"> 62</a></span><span class="line">           audioPluginParameter(<span class="string">'instID'</span>,<span class="string">'DisplayName'</span>,<span class="string">'ID'</span>,<span class="string">'Mapping'</span>,{<span class="string">'int'</span>,1,4}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,63" id="srcline63"> 63</a></span><span class="line">           audioPluginParameter(<span class="string">'trig'</span>,<span class="string">'DisplayName'</span>,<span class="string">'Trigger'</span>,<span class="string">'Mapping'</span>,{<span class="string">'enum'</span>,<span class="string">'noteOff'</span>,<span class="string">'noteOn_'</span>}),<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,64" id="srcline64"> 64</a></span><span class="line">           <span class="string">'InputChannels'</span>,1,<span class="string">'OutputChannels'</span>,1);      </span></span>
<span class="srcline"><span class="lineno"><a href="30,65" id="srcline65"> 65</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,67" id="srcline67"> 67</a></span><span class="line">    <span class="keyword">methods</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,68" id="srcline68"> 68</a></span><span class="line">        <span class="keyword">function</span> obj = impactSynth() <span class="comment">% constructor</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,69" id="srcline69"> 69</a></span><span class="line">            obj.fs = getSampleRate(obj);</span></span>
<span class="srcline"><span class="lineno"><a href="30,70" id="srcline70"> 70</a></span><span class="line">            obj.maxFrameSize = 16384; <span class="comment">% 2^14</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,71" id="srcline71"> 71</a></span><span class="line">            obj.buff = [zeros(1,obj.fs*obj.t);</span></span>
<span class="srcline"><span class="lineno"><a href="30,72" id="srcline72"> 72</a></span><span class="line">                        zeros(1,obj.fs*obj.t);</span></span>
<span class="srcline"><span class="lineno"><a href="30,73" id="srcline73"> 73</a></span><span class="line">                        zeros(1,obj.fs*obj.t);</span></span>
<span class="srcline"><span class="lineno"><a href="30,74" id="srcline74"> 74</a></span><span class="line">                        zeros(1,obj.fs*obj.t)];</span></span>
<span class="srcline"><span class="lineno"><a href="30,75" id="srcline75"> 75</a></span><span class="line">            obj.frameBuff = zeros(1,obj.maxFrameSize);</span></span>
<span class="srcline"><span class="lineno"><a href="30,76" id="srcline76"> 76</a></span><span class="line">            obj.strikeGain = ones(1,length(obj.modes(1,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="30,77" id="srcline77"> 77</a></span><span class="line">            obj.resPadded = [obj.resBank(1,:), zeros(1, obj.fs*obj.t-length(obj.resBank(1,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="30,78" id="srcline78"> 78</a></span><span class="line">                             obj.resBank(2,:), zeros(1, obj.fs*obj.t-length(obj.resBank(2,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="30,79" id="srcline79"> 79</a></span><span class="line">                             obj.resBank(3,:), zeros(1, obj.fs*obj.t-length(obj.resBank(3,:)));</span></span>
<span class="srcline"><span class="lineno"><a href="30,80" id="srcline80"> 80</a></span><span class="line">                             obj.resBank(4,:), zeros(1, obj.fs*obj.t-length(obj.resBank(4,:)));];</span></span>
<span class="srcline"><span class="lineno"><a href="30,81" id="srcline81"> 81</a></span><span class="line">        <span class="keyword">end</span>                                   </span></span>
<span class="srcline"><span class="lineno"><a href="30,82" id="srcline82"> 82</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,83" id="srcline83"> 83</a></span><span class="line">        <span class="keyword">function</span> reset(obj)</span></span>
<span class="srcline"><span class="lineno"><a href="30,84" id="srcline84"> 84</a></span><span class="line">            obj.readIndex = [1; 1; 1; 1];</span></span>
<span class="srcline"><span class="lineno"><a href="30,85" id="srcline85"> 85</a></span><span class="line">            obj.soundOut = [0; 0; 0; 0];</span></span>
<span class="srcline"><span class="lineno"><a href="30,86" id="srcline86"> 86</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="30,87" id="srcline87"> 87</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,88" id="srcline88"> 88</a></span><span class="line">        <span class="keyword">function</span> set.trig(obj, val)</span></span>
<span class="srcline"><span class="lineno"><a href="30,89" id="srcline89"> 89</a></span><span class="line">            <span class="keyword">if</span> val == <span class="string">'noteOn_'</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,90" id="srcline90"> 90</a></span><span class="line">                obj.readIndex(obj.instID) = 1; <span class="comment">% init readIndex of respective buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,91" id="srcline91"> 91</a></span><span class="line">                obj.soundOut(obj.instID) = 1; <span class="comment">% trigger sound according to instrument ID</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,93" id="srcline93"> 93</a></span><span class="line">                <span class="comment">%=================================== sound synthesis</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,94" id="srcline94"> 94</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="30,95" id="srcline95"> 95</a></span><span class="line">                obj.lpfPole = abs(obj.material-0.001); <span class="comment">% material</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,96" id="srcline96"> 96</a></span><span class="line">                obj.excGain = obj.strikeVig; <span class="comment">% strike vigor</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,97" id="srcline97"> 97</a></span><span class="line">                obj.m = (obj.strikeGain(length(obj.strikeGain))-obj.strikePos) / (length(obj.strikeGain)-1);</span></span>
<span class="srcline"><span class="lineno"><a href="30,98" id="srcline98"> 98</a></span><span class="line">                obj.strikeGain = obj.m * [1:length(obj.strikeGain)] + obj.strikePos - obj.m; <span class="comment">% (y=mx+b) strike postion</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,99" id="srcline99"> 99</a></span><span class="line">                </span></span>
<span class="srcline"><span class="lineno"><a href="30,100" id="srcline100">100</a></span><span class="line">                obj.buff(obj.instID,:) = f_bdwg(obj.modes(1:24)*obj.dimension, obj.decay(1:24), length(obj.buff(1,:)), obj.fs, [0.999; 1.001], 0.9, obj.strikeGain)'; <span class="comment">% banded waveguide</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,101" id="srcline101">101</a></span><span class="line">                <span class="comment">% waveguide mesh</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,102" id="srcline102">102</a></span><span class="line">                obj.buff(obj.instID,:) = ifft(real(fft(obj.buff(obj.instID,:))) .* real(fft(obj.resPadded(obj.instID,:)))); <span class="comment">% convolution with residual</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,103" id="srcline103">103</a></span><span class="line">                <span class="comment">%===================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,105" id="srcline105">105</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,107" id="srcline107">107</a></span><span class="line">            obj.noteState = val;</span></span>
<span class="srcline"><span class="lineno"><a href="30,108" id="srcline108">108</a></span><span class="line">        <span class="keyword">end</span> </span></span>
<span class="srcline"><span class="lineno"><a href="30,109" id="srcline109">109</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,110" id="srcline110">110</a></span><span class="line">        <span class="keyword">function</span> val = get.trig(obj)</span></span>
<span class="srcline"><span class="lineno"><a href="30,111" id="srcline111">111</a></span><span class="line">            val = obj.noteState;</span></span>
<span class="srcline"><span class="lineno"><a href="30,112" id="srcline112">112</a></span><span class="line">        <span class="keyword">end</span> </span></span>
</pre>
</div>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="30,113" id="srcline113">113</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,114" id="srcline114">114</a></span><span class="line">        <span class="keyword">function</span> <span class="var type1" id="S50T18U755">out</span> = process(<span class="var type1" id="S51T136U758">obj</span>, <span class="var type1" id="S52T18U759">in</span>) </span></span>
<span class="srcline"><span class="lineno"><a href="30,115" id="srcline115">115</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,116" id="srcline116">116</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T7:U4"><span class="mxinfo " id="T3:U5">sum(<span class="mxinfo " id="T11:U6"><span class="var type1" id="S51T136U766">obj</span>.soundOut</span>)</span>&gt;<span class="mxinfo " id="T3:U8">0</span></span> <span class="comment">% do not process if all state variables are false</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,117" id="srcline117">117</a></span><span class="line">                <span class="keyword">for</span> <span class="var type1" id="S54T3U771">i</span>=<span class="mxinfo " id="T11:U10"><span class="mxinfo " id="T3:U11">1</span>:length(<span class="var type1" id="S51T136U777">obj</span>.soundOut)</span> <span class="comment">% iteration through synth buffers</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,118" id="srcline118">118</a></span><span class="line">                    <span class="keyword">if</span> <span class="mxinfo " id="T7:U13"><span class="mxinfo " id="T3:U14"><span class="mxinfo " id="T11:U15"><span class="var type1" id="S51T136U784">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U786">i</span>)</span> &lt; <span class="mxinfo " id="T3:U18"><span class="mxinfo " id="T3:U19">length(<span class="mxinfo " id="T12:U20"><span class="mxinfo " id="T10:U21"><span class="var type1" id="S51T136U792">obj</span>.buff</span>(<span class="var type1" id="S54T3U794">i</span>,<span class="mxinfo " id="T20:U24">:</span>)</span>)</span> - <span class="mxinfo " id="T3:U25">length(<span class="var type1" id="S52T18U798">in</span>)</span></span></span> <span class="comment">% buffer length not exceeded - add wavefrom</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,119" id="srcline119">119</a></span><span class="line">                        </span></span>
<span class="srcline"><span class="lineno"><a href="30,120" id="srcline120">120</a></span><span class="line">                        <span class="mxinfo " id="T12:U27"><span class="mxinfo " id="T12:U28"><span class="mxinfo " id="T12:U29"><span class="var type1" id="S51T136U803">obj</span>.frameBuff</span>(<span class="mxinfo " id="T12:U31"><span class="mxinfo " id="T3:U32">1</span>:length(<span class="var type1" id="S52T18U809">in</span>)</span>)</span> = <span class="mxinfo " id="T12:U34"><span class="mxinfo " id="T12:U35"><span class="mxinfo " id="T12:U36"><span class="var type1" id="S51T136U813">obj</span>.frameBuff</span>(<span class="mxinfo " id="T12:U38"><span class="mxinfo " id="T3:U39">1</span>:length(<span class="var type1" id="S52T18U819">in</span>)</span>)</span><span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,121" id="srcline121">121</a></span><span class="line">                        + <span class="mxinfo " id="T12:U41"><span class="mxinfo " id="T12:U42"><span class="mxinfo " id="T10:U43"><span class="var type1" id="S51T136U823">obj</span>.buff</span>(<span class="var type1" id="S54T3U825">i</span>,<span class="mxinfo " id="T18:U46"><span class="mxinfo " id="T3:U47"><span class="mxinfo " id="T11:U48"><span class="var type1" id="S51T136U829">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U831">i</span>)</span>:<span class="mxinfo " id="T3:U51"><span class="mxinfo " id="T3:U52"><span class="mxinfo " id="T11:U53"><span class="var type1" id="S51T136U835">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U837">i</span>)</span>+(<span class="mxinfo " id="T3:U56"><span class="mxinfo " id="T3:U57">length(<span class="var type1" id="S52T18U842">in</span>)</span>-<span class="mxinfo " id="T3:U59">1</span></span>)</span></span>)</span><span class="keyword">...</span><span class="comment"> <span class="comment">% read from synth buffer, write to frame buffer</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="30,122" id="srcline122">122</a></span><span class="line">                        * <span class="mxinfo " id="T3:U60"><span class="mxinfo " id="T11:U61"><span class="var type1" id="S51T136U846">obj</span>.soundOut</span>(<span class="var type1" id="S54T3U848">i</span>)</span></span></span></span>; <span class="comment">% applying state variable (only adding active instruments)</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,123" id="srcline123">123</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,124" id="srcline124">124</a></span><span class="line">                        <span class="mxinfo " id="T3:U64"><span class="mxinfo " id="T3:U65"><span class="mxinfo " id="T11:U66"><span class="var type1" id="S51T136U853">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U855">i</span>)</span> = <span class="mxinfo " id="T3:U69"><span class="mxinfo " id="T3:U70"><span class="mxinfo " id="T11:U71"><span class="var type1" id="S51T136U859">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U861">i</span>)</span> + <span class="mxinfo " id="T3:U74">length(<span class="var type1" id="S52T18U864">in</span>)</span></span></span>; <span class="comment">% increment readIndex by frame size</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,125" id="srcline125">125</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,126" id="srcline126">126</a></span><span class="line">                    <span class="keyword">else</span> <span class="comment">% buffer length exceeded - add zeros  </span></span></span>
<span class="srcline"><span class="lineno"><a href="30,127" id="srcline127">127</a></span><span class="line">                        <span class="mxinfo " id="T3:U76"><span class="mxinfo " id="T3:U77"><span class="mxinfo " id="T11:U78"><span class="var type1" id="S51T136U870">obj</span>.readIndex</span>(<span class="var type1" id="S54T3U872">i</span>)</span> = <span class="mxinfo " id="T3:U81">1</span></span>; <span class="comment">% init readIndex</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,128" id="srcline128">128</a></span><span class="line">                        <span class="mxinfo " id="T3:U82"><span class="mxinfo " id="T3:U83"><span class="mxinfo " id="T11:U84"><span class="var type1" id="S51T136U878">obj</span>.soundOut</span>(<span class="var type1" id="S54T3U880">i</span>)</span> = <span class="mxinfo " id="T3:U87">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="30,129" id="srcline129">129</a></span><span class="line">                    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,130" id="srcline130">130</a></span><span class="line">                <span class="keyword">end</span>    </span></span>
<span class="srcline"><span class="lineno"><a href="30,131" id="srcline131">131</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,132" id="srcline132">132</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,133" id="srcline133">133</a></span><span class="line">            <span class="mxinfo " id="T18:U88"><span class="var type1" id="S50T18U884">out</span> = <span class="mxinfo " id="T18:U90">(<span class="mxinfo " id="T12:U91"><span class="mxinfo " id="T12:U92"><span class="mxinfo " id="T12:U93"><span class="var type1" id="S51T136U890">obj</span>.frameBuff</span>(<span class="mxinfo " id="T12:U95"><span class="mxinfo " id="T3:U96">1</span>:length(<span class="var type1" id="S52T18U896">in</span>)</span>)</span>*<span class="mxinfo " id="T3:U98"><span class="var type1" id="S51T136U898">obj</span>.excGain</span></span>)'</span></span>; <span class="comment">% output</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,134" id="srcline134">134</a></span><span class="line">            <span class="mxinfo " id="T12:U100"><span class="mxinfo " id="T12:U101"><span class="var type1" id="S51T136U903">obj</span>.frameBuff</span> = <span class="mxinfo " id="T12:U103">zeros(<span class="mxinfo " id="T3:U104">1</span>,<span class="mxinfo " id="T3:U105">length(<span class="mxinfo " id="T12:U106"><span class="var type1" id="S51T136U911">obj</span>.frameBuff</span>)</span>)</span></span>; <span class="comment">% clear frame buffer</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,136" id="srcline136">136</a></span><span class="line">        <span class="keyword">end</span>  </span></span>
</pre>
<div class="dead">
<pre class="code">
<span class="srcline"><span class="lineno"><a href="30,137" id="srcline137">137</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,138" id="srcline138">138</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,139" id="srcline139">139</a></span><span class="line">    <span class="keyword">methods</span> (Static)        </span></span>
<span class="srcline"><span class="lineno"><a href="30,140" id="srcline140">140</a></span><span class="line">        <span class="keyword">function</span> configureMIDI(obj,varargin)</span></span>
<span class="srcline"><span class="lineno"><a href="30,141" id="srcline141">141</a></span><span class="line">            <span class="comment">% Configure MIDI connections.</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,142" id="srcline142">142</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,143" id="srcline143">143</a></span><span class="line">            privConfigureMIDI(obj,varargin{:});</span></span>
<span class="srcline"><span class="lineno"><a href="30,144" id="srcline144">144</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,145" id="srcline145">145</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,146" id="srcline146">146</a></span><span class="line">        <span class="keyword">function</span> C = getMIDIConnections(obj)</span></span>
<span class="srcline"><span class="lineno"><a href="30,147" id="srcline147">147</a></span><span class="line">            <span class="comment">% Get MIDI connections. </span></span></span>
<span class="srcline"><span class="lineno"><a href="30,148" id="srcline148">148</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,149" id="srcline149">149</a></span><span class="line">            C = privConfigureMIDI(<span class="string">'getConnections'</span>,obj);</span></span>
<span class="srcline"><span class="lineno"><a href="30,150" id="srcline150">150</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,151" id="srcline151">151</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,152" id="srcline152">152</a></span><span class="line">        <span class="keyword">function</span> disconnectMIDI(obj)</span></span>
<span class="srcline"><span class="lineno"><a href="30,153" id="srcline153">153</a></span><span class="line">            <span class="comment">% Disconnect MIDI controls.</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,154" id="srcline154">154</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="30,155" id="srcline155">155</a></span><span class="line">            privConfigureMIDI(<span class="string">'disconnect'</span>,obj);       </span></span>
<span class="srcline"><span class="lineno"><a href="30,156" id="srcline156">156</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,157" id="srcline157">157</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,158" id="srcline158">158</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,159" id="srcline159">159</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,160" id="srcline160">160</a></span><span class="line"><span class="comment">%=================================== synth functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,161" id="srcline161">161</a></span><span class="line"><span class="keyword">function</span> out = bands(freq, time)</span></span>
<span class="srcline"><span class="lineno"><a href="30,162" id="srcline162">162</a></span><span class="line">    out = sin(2*pi*freq*time); </span></span>
<span class="srcline"><span class="lineno"><a href="30,163" id="srcline163">163</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,164" id="srcline164">164</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,165" id="srcline165">165</a></span><span class="line"><span class="keyword">function</span> out = f_bdwg( freqs, decay, Tsamp, fs, low_high, damp, bandCoeff)</span></span>
<span class="srcline"><span class="lineno"><a href="30,166" id="srcline166">166</a></span><span class="line">    <span class="comment">% Banded digital waveguide function</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,167" id="srcline167">167</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,168" id="srcline168">168</a></span><span class="line">    <span class="comment">%% variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,169" id="srcline169">169</a></span><span class="line">    n_modes = length(freqs); <span class="comment">% number of modes</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,170" id="srcline170">170</a></span><span class="line">    d = zeros(1, n_modes); <span class="comment">% length of delay lines (Samples)</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,171" id="srcline171">171</a></span><span class="line">    <span class="keyword">for</span> i = 1:n_modes</span></span>
<span class="srcline"><span class="lineno"><a href="30,172" id="srcline172">172</a></span><span class="line">        d(i) = floor(fs/freqs(i));</span></span>
<span class="srcline"><span class="lineno"><a href="30,173" id="srcline173">173</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,174" id="srcline174">174</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,175" id="srcline175">175</a></span><span class="line">    <span class="comment">%% initialization</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,176" id="srcline176">176</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,177" id="srcline177">177</a></span><span class="line">    L = rand(1, max(d)); <span class="comment">% initialize delay lines with white noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,178" id="srcline178">178</a></span><span class="line">    L = L - mean(L);</span></span>
<span class="srcline"><span class="lineno"><a href="30,179" id="srcline179">179</a></span><span class="line">    L = L/max(L);</span></span>
<span class="srcline"><span class="lineno"><a href="30,180" id="srcline180">180</a></span><span class="line">    L = repmat(L,n_modes,1);</span></span>
<span class="srcline"><span class="lineno"><a href="30,181" id="srcline181">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="30,182" id="srcline182">182</a></span><span class="line">    out = zeros(1, Tsamp); <span class="comment">% output</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,183" id="srcline183">183</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,184" id="srcline184">184</a></span><span class="line">    p_out = 3*ones(1,n_modes); <span class="comment">% pointers out      (see shift register)</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,185" id="srcline185">185</a></span><span class="line">    p_out1 = 2*ones(1,n_modes);</span></span>
<span class="srcline"><span class="lineno"><a href="30,186" id="srcline186">186</a></span><span class="line">    p_out2 = 1*ones(1,n_modes);</span></span>
<span class="srcline"><span class="lineno"><a href="30,187" id="srcline187">187</a></span><span class="line">    <span class="comment">%p_out3 = 1*ones(1,n_modes);</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,188" id="srcline188">188</a></span><span class="line">    p_in = 6*ones(1,n_modes); <span class="comment">% pointers in</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,189" id="srcline189">189</a></span><span class="line">    p_in1 = 5*ones(1,n_modes);</span></span>
<span class="srcline"><span class="lineno"><a href="30,190" id="srcline190">190</a></span><span class="line">    p_in2 = 4*ones(1,n_modes);</span></span>
<span class="srcline"><span class="lineno"><a href="30,191" id="srcline191">191</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,192" id="srcline192">192</a></span><span class="line">    <span class="comment">%% bandpass according to paper (following Steiglitz's DSP book, 1996)</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,193" id="srcline193">193</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,194" id="srcline194">194</a></span><span class="line">    f_low_high = low_high*freqs;</span></span>
<span class="srcline"><span class="lineno"><a href="30,195" id="srcline195">195</a></span><span class="line">    B = f_low_high(2,:) - f_low_high(1,:); <span class="comment">% bandwidth</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,196" id="srcline196">196</a></span><span class="line">    <span class="comment">% B = B';</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,197" id="srcline197">197</a></span><span class="line">    B_rad = 2*pi/fs*B; <span class="comment">% bandwidth in radians/samp</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,198" id="srcline198">198</a></span><span class="line">    psi = 2*pi/fs*freqs; <span class="comment">% center frequencies in radians/samp</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,199" id="srcline199">199</a></span><span class="line">    R = 1 - B_rad/2;</span></span>
<span class="srcline"><span class="lineno"><a href="30,200" id="srcline200">200</a></span><span class="line">    cosT = 2*R/(1+R.^2) * cos(psi);</span></span>
<span class="srcline"><span class="lineno"><a href="30,201" id="srcline201">201</a></span><span class="line">    A0 = (1-R.^2)/2; <span class="comment">% normalization scale factor or gain adjustment</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,202" id="srcline202">202</a></span><span class="line">    <span class="comment">% A0 = sqrt(A0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,203" id="srcline203">203</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,204" id="srcline204">204</a></span><span class="line">    <span class="comment">% a and b coefficients</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,205" id="srcline205">205</a></span><span class="line">    a = zeros(n_modes, 3);</span></span>
<span class="srcline"><span class="lineno"><a href="30,206" id="srcline206">206</a></span><span class="line">    b = zeros(n_modes, 3);</span></span>
<span class="srcline"><span class="lineno"><a href="30,207" id="srcline207">207</a></span><span class="line">    <span class="keyword">for</span> i = 1:n_modes</span></span>
<span class="srcline"><span class="lineno"><a href="30,208" id="srcline208">208</a></span><span class="line">        b(i,:) = [A0(i), 0, -A0(i)]; <span class="comment">% b coeff dependent of scaling gain factor</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,209" id="srcline209">209</a></span><span class="line">        a(i,:) = [1, -2*R(i)*cosT(i), R(i)^2]; <span class="comment">% a coeff depending on R and cosT     </span></span></span>
<span class="srcline"><span class="lineno"><a href="30,210" id="srcline210">210</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,211" id="srcline211">211</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,212" id="srcline212">212</a></span><span class="line">    <span class="comment">% a = zeros(n_modes, 4);</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,213" id="srcline213">213</a></span><span class="line">    <span class="comment">% b = zeros(n_modes, 3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,214" id="srcline214">214</a></span><span class="line">    <span class="comment">% for i = 1:n_modes</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,215" id="srcline215">215</a></span><span class="line">    <span class="comment">%     u = 2*R(i)*cosT(i);</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,216" id="srcline216">216</a></span><span class="line">    <span class="comment">%     v = R(i)^2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,217" id="srcline217">217</a></span><span class="line">    <span class="comment">%     b(i,:) = [A0(i)*(1-damp), 0, -A0(i)*(1-damp)]; % b coeff dependent of scaling gain factor</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,218" id="srcline218">218</a></span><span class="line">    <span class="comment">%     a(i,:) = [1, -(u+damp), v+u*damp, -v*damp]; % a coeff depending on R and cosT     </span></span></span>
<span class="srcline"><span class="lineno"><a href="30,219" id="srcline219">219</a></span><span class="line">    <span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,220" id="srcline220">220</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,221" id="srcline221">221</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,222" id="srcline222">222</a></span><span class="line">    <span class="comment">%% main loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,223" id="srcline223">223</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,224" id="srcline224">224</a></span><span class="line">    <span class="keyword">for</span> i=1:Tsamp</span></span>
<span class="srcline"><span class="lineno"><a href="30,225" id="srcline225">225</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,226" id="srcline226">226</a></span><span class="line">        out(i) = 0;</span></span>
<span class="srcline"><span class="lineno"><a href="30,227" id="srcline227">227</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,228" id="srcline228">228</a></span><span class="line">        <span class="keyword">for</span> j = 1:n_modes</span></span>
<span class="srcline"><span class="lineno"><a href="30,229" id="srcline229">229</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,230" id="srcline230">230</a></span><span class="line">            <span class="comment">% bandpass filter y[n] = b1*x[n] + b2*x[n-1] + b3*x[n-2] - a2*y[n-1] - a3*y[n-2]</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,231" id="srcline231">231</a></span><span class="line">            L(j, p_out(j)) = decay(j) * (b(j,1)*L(j, p_in(j)) + <span class="keyword">...</span><span class="comment">                               <span class="comment">% b(j,2)*L(j, p_in1(j))... (=0)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="30,232" id="srcline232">232</a></span><span class="line">                + b(j,3)*L(j, p_in2(j)) - a(j,2)*L(j, p_out1(j)) - a(j,3)*L(j, p_out2(j)));</span></span>
<span class="srcline"><span class="lineno"><a href="30,233" id="srcline233">233</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,234" id="srcline234">234</a></span><span class="line">    <span class="comment">%         L(j, p_out(j)) = b(j,1)*L(j, p_in(j)) + b(j,3)*L(j, p_in2(j))<span class="keyword">...</span><span class="comment">                      % b(j,2)*L(j, p_in1(j))... (=0)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="30,235" id="srcline235">235</a></span><span class="line">    <span class="comment">%              - a(j,2)*L(j, p_out1(j)) - a(j,3)*L(j, p_out2(j)) - a(j,4)*L(j, p_out3(j));</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,236" id="srcline236">236</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,237" id="srcline237">237</a></span><span class="line">            out(i) = out(i) + L(j,p_out(j))*bandCoeff(j);</span></span>
<span class="srcline"><span class="lineno"><a href="30,238" id="srcline238">238</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,239" id="srcline239">239</a></span><span class="line">            <span class="comment">% update and wrap pointers</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,240" id="srcline240">240</a></span><span class="line">            <span class="keyword">if</span> (p_in(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,241" id="srcline241">241</a></span><span class="line">                p_in(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,242" id="srcline242">242</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,243" id="srcline243">243</a></span><span class="line">                p_in(j)=p_in(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,244" id="srcline244">244</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,245" id="srcline245">245</a></span><span class="line">            <span class="keyword">if</span> (p_in1(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,246" id="srcline246">246</a></span><span class="line">                p_in1(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,247" id="srcline247">247</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,248" id="srcline248">248</a></span><span class="line">                p_in1(j)=p_in1(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,249" id="srcline249">249</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,250" id="srcline250">250</a></span><span class="line">            <span class="keyword">if</span> (p_in2(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,251" id="srcline251">251</a></span><span class="line">                p_in2(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,252" id="srcline252">252</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,253" id="srcline253">253</a></span><span class="line">                p_in2(j)=p_in2(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,254" id="srcline254">254</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,255" id="srcline255">255</a></span><span class="line">            <span class="keyword">if</span> (p_out(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,256" id="srcline256">256</a></span><span class="line">                p_out(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,257" id="srcline257">257</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,258" id="srcline258">258</a></span><span class="line">                p_out(j)=p_out(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,259" id="srcline259">259</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,260" id="srcline260">260</a></span><span class="line">            <span class="keyword">if</span> (p_out1(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,261" id="srcline261">261</a></span><span class="line">                p_out1(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,262" id="srcline262">262</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,263" id="srcline263">263</a></span><span class="line">                p_out1(j)=p_out1(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,264" id="srcline264">264</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,265" id="srcline265">265</a></span><span class="line">            <span class="keyword">if</span> (p_out2(j)==d(j))</span></span>
<span class="srcline"><span class="lineno"><a href="30,266" id="srcline266">266</a></span><span class="line">                p_out2(j)=1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,267" id="srcline267">267</a></span><span class="line">            <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,268" id="srcline268">268</a></span><span class="line">                p_out2(j)=p_out2(j)+1;</span></span>
<span class="srcline"><span class="lineno"><a href="30,269" id="srcline269">269</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,270" id="srcline270">270</a></span><span class="line">    <span class="comment">%         if (p_out3(j)==d(j))</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,271" id="srcline271">271</a></span><span class="line">    <span class="comment">%             p_out3(j)=1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,272" id="srcline272">272</a></span><span class="line">    <span class="comment">%         else</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,273" id="srcline273">273</a></span><span class="line">    <span class="comment">%             p_out3(j)=p_out3(j)+1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,274" id="srcline274">274</a></span><span class="line">    <span class="comment">%         end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,275" id="srcline275">275</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="30,276" id="srcline276">276</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,277" id="srcline277">277</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="30,278" id="srcline278">278</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,279" id="srcline279">279</a></span><span class="line">    out = out / max(out);</span></span>
<span class="srcline"><span class="lineno"><a href="30,280" id="srcline280">280</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="30,281" id="srcline281">281</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,282" id="srcline282">282</a></span><span class="line"><span class="comment">%===================================</span></span></span>
<span class="srcline"><span class="lineno"><a href="30,283" id="srcline283">283</a></span><span class="line"> </span></span>
</pre>
</div>
